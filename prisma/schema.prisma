generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================
// SOURCE TABLES — imported from existing SQL dump
// Use @map for column name quirks. Preserve existing UUIDs.
// ============================================================

model MasterDistrict {
  id                       String    @id @default(uuid())
  name                     String
  cdsCode                  String    @unique @map("cdsCode")
  code                     String?
  street                   String?
  city                     String?
  state                    String?
  zip                      String?
  county                   String?
  phone                    String?
  website                  String?
  docType                  String?   @map("docType")
  superintendentFirstName  String?   @map("adminFirstName")
  superintendentLastName   String?   @map("adminLastName")
  latitude                 Float?    @map("lattitute")
  longitude                Float?
  ncesDistrictId           String?   @map("ncesDistrict")
  statusType               String?   @map("statusType")
  createdAt                DateTime  @default(now()) @map("createdAt")
  updatedAt                DateTime  @updatedAt @map("updatedAt")

  // Relationships
  districtInfo      DistrictInfo[]
  schools           School[]
  savedDistricts    SavedDistrict[]
  excludedDistricts ExcludedDistrict[]
  playbooks         Playbook[]

  @@index([county])
  @@index([docType])
  @@index([name])
  @@index([statusType])
  @@map("master_district")
}

model DistrictInfo {
  id                      String    @id @default(uuid())
  masterDistrictId        String    @map("masterDistrictId")
  academicYear            String    @map("academicYear")
  status                  String?
  gradeServed             String?   @map("gradeServed")
  lowGrade                String?   @map("lowGrade")
  highGrade               String?   @map("highGrade")
  numberOfSchools         Int?      @map("noOfSchools")
  totalEnrollment         Int?      @map("totalEnrollment")
  studentSpending         Float?    @map("studentSpending")
  ellPercentage           Float?    @map("ell")
  totalEll                Int?      @map("totalEl")
  frpmCount               Int?      @map("frpmCount")
  frpmEnrollment          Int?      @map("frpmEnrollment")
  spedCount               Int?      @map("sped")
  chronicAbsenteeismRate  Float?    @map("chronicAbsenteeismRate")
  elaProficiency          Float?    @map("elaProficiency")
  mathProficiency         Float?    @map("mathProficiency")
  createdAt               DateTime  @default(now()) @map("createdAt")
  updatedAt               DateTime  @updatedAt @map("updatedAt")

  // Relationships
  masterDistrict MasterDistrict @relation(fields: [masterDistrictId], references: [id])

  @@unique([masterDistrictId, academicYear])
  @@index([masterDistrictId])
  @@index([academicYear])
  @@map("district_info")
}

model School {
  id                 String    @id @default(uuid())
  masterDistrictId   String?   @map("masterDistrictId")
  academicYear       String?   @map("academicYear")
  name               String
  cdsCode            String    @map("cdsCode")
  district           String?
  gradesOffered      String?   @map("gsOffered")
  gradesServed       String?   @map("gsServed")
  charter            String?
  virtual            String?
  magnet             String?
  street             String?
  city               String?
  state              String?
  zip                String?
  phone              String?
  website            String?
  principalFirstName String?   @map("adminFirstName")
  principalLastName  String?   @map("adminLastName")
  latitude           Float?    @map("lattitute")
  longitude          Float?
  statusType         String?   @map("statusType")
  createdAt          DateTime  @default(now()) @map("createdAt")
  updatedAt          DateTime  @updatedAt @map("updatedAt")

  // Relationships
  masterDistrict MasterDistrict? @relation(fields: [masterDistrictId], references: [id])

  @@index([cdsCode])
  @@index([masterDistrictId])
  @@index([statusType])
  @@index([academicYear])
  @@map("school")
}

// ============================================================
// NEW APPLICATION TABLES — not in SQL dump
// Support MVP v2 features. Use Clerk user IDs (string).
// ============================================================

model SavedDistrict {
  id         String   @id @default(uuid())
  userId     String
  tenantId   String
  districtId String
  savedAt    DateTime @default(now())

  // Relationships
  district MasterDistrict @relation(fields: [districtId], references: [id])

  @@unique([userId, districtId])
  @@index([userId])
  @@index([tenantId])
  @@map("saved_district")
}

model ExcludedDistrict {
  id                    String   @id @default(uuid())
  userId                String
  tenantId              String
  districtId            String
  category              String
  note                  String?
  excludedByUserId      String
  excludedByDisplayName String
  excludedAt            DateTime @default(now())

  // Relationships
  district MasterDistrict @relation(fields: [districtId], references: [id])

  @@unique([tenantId, districtId])
  @@index([userId])
  @@index([tenantId])
  @@map("excluded_district")
}

model Product {
  id              String   @id @default(uuid())
  tenantId        String
  name            String
  description     String
  gradeFrom       Int
  gradeTo         Int
  subjectArea     String
  keyFeatures     String[]
  targetChallenges String[]
  competitiveDifferentiators String[]
  approvedMessaging String[]
  assets          Json     @default("[]")
  isDeleted       Boolean  @default(false)
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([tenantId])
  @@index([tenantId, isDeleted])
  @@map("product")
}

model Playbook {
  id              String   @id @default(uuid())
  tenantId        String
  districtId      String
  productIds      String[]
  productNames    String[]
  fitScore        Int?
  fitRationale    String?
  status          String   @default("draft")
  sections        Json     @default("[]")
  isDeleted       Boolean  @default(false)
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  district MasterDistrict @relation(fields: [districtId], references: [id])

  @@index([tenantId])
  @@index([tenantId, isDeleted])
  @@index([districtId])
  @@index([createdBy])
  @@map("playbook")
}

model ControlledVocabulary {
  id              String   @id @default(uuid())
  vocabularyName  String
  value           String
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([vocabularyName, value])
  @@index([vocabularyName, isActive])
  @@map("controlled_vocabulary")
}
