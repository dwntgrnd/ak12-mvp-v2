---
phase: 01-foundation-shell
plan: 02
type: execute
wave: 2
depends_on: [01]
files_modified:
  - src/services/types/common.ts
  - src/services/types/controlled-vocabulary.ts
  - src/services/types/auth.ts
  - src/services/types/tenant.ts
  - src/services/types/user.ts
  - src/services/types/product.ts
  - src/services/types/district.ts
  - src/services/types/playbook.ts
  - src/services/interfaces/auth-service.ts
  - src/services/interfaces/tenant-service.ts
  - src/services/interfaces/user-service.ts
  - src/services/interfaces/product-service.ts
  - src/services/interfaces/district-service.ts
  - src/services/interfaces/playbook-service.ts
  - src/services/index.ts
autonomous: true

must_haves:
  truths:
    - "All 6 service interfaces exist with correct method signatures (36 methods total)"
    - "All domain types from the service contracts are represented as TypeScript interfaces"
    - "Controlled vocabulary types (GradeRange, SubjectArea, ExclusionCategory) are const arrays with derived types"
    - "Service registry exports all interface types from a single entry point"
    - "TypeScript compiles with zero errors in strict mode"
  artifacts:
    - path: "src/services/types/common.ts"
      provides: "Pagination, ServiceError, FitAssessment, ServiceContext, UserRole, ContentSource, SectionStatus"
      exports: ["PaginatedRequest", "PaginatedResponse", "ServiceError", "FitCategory", "FitAssessment", "ServiceContext", "UserRole"]
    - path: "src/services/types/controlled-vocabulary.ts"
      provides: "Const arrays and derived types for grade ranges, subject areas, exclusion categories"
      exports: ["GRADE_RANGES", "GradeRange", "SUBJECT_AREAS", "SubjectArea", "EXCLUSION_CATEGORIES", "ExclusionCategory"]
    - path: "src/services/types/auth.ts"
      provides: "AuthCredentials, AuthSession, UserProfile"
      exports: ["AuthCredentials", "AuthSession", "UserProfile"]
    - path: "src/services/types/tenant.ts"
      provides: "TenantSummary, CreateTenantRequest, OrganizationStatus"
      exports: ["TenantSummary", "CreateTenantRequest", "OrganizationStatus"]
    - path: "src/services/types/user.ts"
      provides: "TenantUser, InviteUserRequest"
      exports: ["TenantUser", "InviteUserRequest"]
    - path: "src/services/types/product.ts"
      provides: "Product, ProductSummary, ProductAsset, ProductFilters, CreateProductRequest, UpdateProductRequest"
      exports: ["Product", "ProductSummary", "ProductAsset", "ProductFilters", "CreateProductRequest", "UpdateProductRequest"]
    - path: "src/services/types/district.ts"
      provides: "DistrictSummary, DistrictProfile, DistrictSearchRequest, FilterFacet, FilterOption, SavedDistrict, ExclusionReason, ExcludedDistrict"
      exports: ["DistrictSummary", "DistrictProfile", "DistrictSearchRequest", "FilterFacet", "SavedDistrict", "ExcludedDistrict"]
    - path: "src/services/types/playbook.ts"
      provides: "PlaybookSummary, Playbook, PlaybookSection, PlaybookFilters, PlaybookGenerationRequest, PlaybookStatusResponse"
      exports: ["PlaybookSummary", "Playbook", "PlaybookSection", "PlaybookFilters", "PlaybookGenerationRequest", "PlaybookStatusResponse"]
    - path: "src/services/interfaces/district-service.ts"
      provides: "IDistrictService with 10 methods"
      exports: ["IDistrictService"]
    - path: "src/services/interfaces/playbook-service.ts"
      provides: "IPlaybookService with 9 methods"
      exports: ["IPlaybookService"]
    - path: "src/services/index.ts"
      provides: "Service registry re-exporting all 6 interfaces and all types"
      exports: ["IAuthService", "IDistrictService", "IPlaybookService", "IProductService", "ITenantService", "IUserService"]
  key_links:
    - from: "src/services/interfaces/district-service.ts"
      to: "src/services/types/district.ts"
      via: "Import domain types"
      pattern: "import.*DistrictProfile.*district"
    - from: "src/services/interfaces/playbook-service.ts"
      to: "src/services/types/playbook.ts"
      via: "Import domain types"
      pattern: "import.*Playbook.*playbook"
    - from: "src/services/interfaces/product-service.ts"
      to: "src/services/types/product.ts"
      via: "Import domain types"
      pattern: "import.*Product.*product"
    - from: "src/services/index.ts"
      to: "src/services/interfaces/*"
      via: "Re-exports all service interfaces"
      pattern: "export.*IAuthService"
---

<objective>
Define all TypeScript types and service interfaces for the 6 services (36 methods total) from the AlchemyK12 service contracts. This creates the typed contract layer between UI components and data providers.

Purpose: Establish the service contract boundary that decouples UI from data access. These interfaces will be implemented by local Prisma providers in Phase 2 and swapped to AWS API providers later.
Output: Complete type system and interface definitions for AuthService, TenantService, UserService, ProductService, DistrictService, and PlaybookService.
</objective>

<execution_context>
@/Users/dorenberge/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dorenberge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-shell/01-01-SUMMARY.md

Primary reference for ALL types and method signatures:
@/Users/dorenberge/WorkInProgress/UI-Projects-Vault/Projects/AK12-MVP-v2/Assets/AlchemyK12_Service-Contracts-Clean_CURRENT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared types and domain type files</name>
  <files>
    src/services/types/common.ts
    src/services/types/controlled-vocabulary.ts
    src/services/types/auth.ts
    src/services/types/tenant.ts
    src/services/types/user.ts
    src/services/types/product.ts
    src/services/types/district.ts
    src/services/types/playbook.ts
  </files>
  <action>
    Create all type definition files, copying EXACTLY from the service contracts document. Each type must match the contract precisely.

    1. **`src/services/types/common.ts`** — Cross-cutting types:
       - `PaginatedRequest` (page defaults 1, pageSize defaults 25)
       - `PaginatedResponse<T>` (items, totalCount, page, pageSize, totalPages)
       - `ServiceError` (code, message, field?, retryable)
       - `FitCategory` ('strong' | 'moderate' | 'low')
       - `FitAssessment` (fitCategory, fitRationale)
       - `ContentSource` ('verbatim' | 'constrained' | 'synthesis' | 'hybrid')
       - `SectionStatus` ('pending' | 'generating' | 'complete' | 'error')
       - `UserRole` ('super-admin' | 'publisher-admin' | 'publisher-rep')
       - `ServiceContext` (userId, tenantId, userRole, organizationName)

    2. **`src/services/types/controlled-vocabulary.ts`** — Const arrays + derived types:
       - `GRADE_RANGES` const array with 9 values: 'Pre-K', 'K-2', '3-5', '6-8', '9-12', 'K-5', 'K-8', '6-12', 'K-12'
       - `GradeRange` = typeof GRADE_RANGES[number]
       - `SUBJECT_AREAS` const array with 9 values: 'Math', 'ELA', 'Science', 'Social Studies', 'STEM', 'SEL', 'Intervention', 'Assessment', 'Professional Development'
       - `SubjectArea` = typeof SUBJECT_AREAS[number]
       - `EXCLUSION_CATEGORIES` const array: 'already_customer', 'not_a_fit', 'budget_timing', 'other'
       - `ExclusionCategory` = typeof EXCLUSION_CATEGORIES[number]

    3. **`src/services/types/auth.ts`** — AuthService domain types:
       - `AuthCredentials` (email, password)
       - `AuthSession` (token, expiresAt: string ISO 8601, user: UserProfile)
       - `UserProfile` (userId, tenantId, userRole from common.ts UserRole, displayName, email, organizationName)

    4. **`src/services/types/tenant.ts`** — TenantService domain types:
       - `TenantSummary` (tenantId, organizationName, status: 'active' | 'inactive', userCount, productCount, createdAt)
       - `CreateTenantRequest` (organizationName, adminUser: { email, displayName })
       - `OrganizationStatus` (hasProducts, productCount, userPlaybookCount)

    5. **`src/services/types/user.ts`** — UserService domain types:
       - `TenantUser` (userId, email, displayName, userRole: 'publisher-admin' | 'publisher-rep', status: 'pending' | 'active' | 'deactivated', invitedAt, lastActiveAt?)
       - `InviteUserRequest` (email, displayName, role: 'publisher-admin' | 'publisher-rep')

    6. **`src/services/types/product.ts`** — ProductService domain types:
       - Import GradeRange, SubjectArea from controlled-vocabulary
       - `Product` (productId, tenantId, name, description, gradeRange, subjectArea, keyFeatures?, targetChallenges?, competitiveDifferentiators?, approvedMessaging?, assets: ProductAsset[], createdAt, updatedAt)
       - `ProductSummary` (productId, name, description, gradeRange, subjectArea, assetCount)
       - `ProductAsset` (assetId, fileName, fileType, fileSize, uploadedAt, url)
       - `ProductFilters` (gradeRange?, subjectArea?, searchQuery?)
       - `CreateProductRequest` (name, description, gradeRange, subjectArea, keyFeatures?, targetChallenges?, competitiveDifferentiators?, approvedMessaging?)
       - `UpdateProductRequest` — all fields optional (name?, description?, gradeRange?, subjectArea?, etc.)

    7. **`src/services/types/district.ts`** — DistrictService domain types:
       - Import FitAssessment from common, ExclusionCategory from controlled-vocabulary
       - `DistrictSummary` (districtId, name, location, enrollment)
       - `DistrictProfile` (districtId, name, location, county, enrollment, demographics: Record<string, number>, proficiency: Record<string, number>, funding: Record<string, number>, additionalData: Record<string, unknown>, fitAssessment?: FitAssessment)
       - `DistrictSearchRequest` (searchQuery?, filters?: Record<string, string | number | string[]>, includeExcluded?, page?, pageSize?)
       - `FilterFacet` (filterName, filterLabel, filterType: 'range' | 'select' | 'multi-select', options?: FilterOption[], range?: { min, max, step? })
       - `FilterOption` (value, label, count)
       - `SavedDistrict` (districtId, name, location, enrollment, savedAt)
       - `ExclusionReason` (category: ExclusionCategory, note?)
       - `ExcludedDistrict` (districtId, districtName, reason: ExclusionReason, excludedAt)

    8. **`src/services/types/playbook.ts`** — PlaybookService domain types:
       - Import FitAssessment, FitCategory, ContentSource, SectionStatus from common
       - `PlaybookSummary` (playbookId, districtId, districtName, productIds: string[], productNames: string[], fitAssessment, generatedAt, hasEditedSections, sectionStatuses: Record<string, SectionStatus>)
       - `Playbook` (playbookId, districtId, districtName, productIds, productNames, fitAssessment, generatedAt, sections: PlaybookSection[])
       - `PlaybookSection` (sectionId, sectionType, sectionLabel, contentSource: ContentSource, status: SectionStatus, content?, isEdited, lastEditedAt?, errorMessage?, retryable)
       - `PlaybookFilters` (fitCategory?: FitCategory, sortBy?: 'generatedAt' | 'districtName', sortOrder?: 'asc' | 'desc')
       - `PlaybookGenerationRequest` (districtId, productIds: string[])
       - `PlaybookStatusResponse` (playbookId, overallStatus: 'generating' | 'complete' | 'partial' | 'failed', sections: { sectionId, sectionType, status }[])

    Use `Record<string, unknown>` instead of `Record<string, any>` for additionalData to maintain strict typing. Use `import type` for type-only imports.
  </action>
  <verify>
    - `npx tsc --noEmit` returns exit code 0
    - Each type file exists: `ls src/services/types/` shows all 8 files
    - `grep "PaginatedResponse" src/services/types/common.ts` confirms generic interface
    - `grep "GRADE_RANGES" src/services/types/controlled-vocabulary.ts` confirms const array
    - `grep "DistrictProfile" src/services/types/district.ts` confirms interface
    - `grep "PlaybookSection" src/services/types/playbook.ts` confirms interface
  </verify>
  <done>
    All 8 type files exist with complete domain type definitions matching the service contracts exactly. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create service interfaces and registry</name>
  <files>
    src/services/interfaces/auth-service.ts
    src/services/interfaces/tenant-service.ts
    src/services/interfaces/user-service.ts
    src/services/interfaces/product-service.ts
    src/services/interfaces/district-service.ts
    src/services/interfaces/playbook-service.ts
    src/services/index.ts
  </files>
  <action>
    Create the 6 service interface files and the service registry. Each interface must match the contracts document method signatures EXACTLY.

    1. **`src/services/interfaces/auth-service.ts`** — IAuthService (3 methods):
       - `authenticate(credentials: AuthCredentials): Promise<AuthSession>`
       - `getCurrentUser(): Promise<UserProfile>`
       - `healthCheck(): Promise<{ status: 'ok' | 'degraded' | 'down'; timestamp: string }>`

    2. **`src/services/interfaces/tenant-service.ts`** — ITenantService (4 methods):
       - `createTenant(request: CreateTenantRequest): Promise<TenantSummary>`
       - `getTenants(): Promise<TenantSummary[]>`
       - `getTenantStatus(tenantId: string): Promise<TenantSummary>`
       - `getOrganizationStatus(): Promise<OrganizationStatus>`

    3. **`src/services/interfaces/user-service.ts`** — IUserService (4 methods):
       - `inviteUser(request: InviteUserRequest): Promise<TenantUser>`
       - `getUsers(): Promise<TenantUser[]>`
       - `deactivateUser(userId: string): Promise<TenantUser>`
       - `reactivateUser(userId: string): Promise<TenantUser>`

    4. **`src/services/interfaces/product-service.ts`** — IProductService (6 methods):
       - `getProducts(filters?: ProductFilters): Promise<ProductSummary[]>`
       - `getProduct(productId: string): Promise<Product>`
       - `createProduct(data: CreateProductRequest): Promise<Product>`
       - `updateProduct(productId: string, data: UpdateProductRequest): Promise<Product>`
       - `deleteProduct(productId: string): Promise<void>`
       - `uploadProductAsset(productId: string, file: File): Promise<ProductAsset>`

    5. **`src/services/interfaces/district-service.ts`** — IDistrictService (10 methods):
       - `searchDistricts(request: DistrictSearchRequest): Promise<PaginatedResponse<DistrictSummary>>`
       - `getDistrict(districtId: string): Promise<DistrictProfile>`
       - `getDistrictFitAssessment(districtId: string, productIds: string[]): Promise<FitAssessment>`
       - `getAvailableFilters(): Promise<FilterFacet[]>`
       - `saveDistrict(districtId: string): Promise<SavedDistrict>`
       - `getSavedDistricts(): Promise<SavedDistrict[]>`
       - `removeSavedDistrict(districtId: string): Promise<void>`
       - `excludeDistrict(districtId: string, reason: ExclusionReason): Promise<ExcludedDistrict>`
       - `getExcludedDistricts(): Promise<ExcludedDistrict[]>`
       - `restoreDistrict(districtId: string): Promise<void>`

    6. **`src/services/interfaces/playbook-service.ts`** — IPlaybookService (9 methods):
       - `generatePlaybook(request: PlaybookGenerationRequest): Promise<{ playbookId: string }>`
       - `getPlaybookStatus(playbookId: string): Promise<PlaybookStatusResponse>`
       - `getPlaybook(playbookId: string): Promise<Playbook>`
       - `getPlaybookSection(playbookId: string, sectionId: string): Promise<PlaybookSection>`
       - `getPlaybooks(filters?: PlaybookFilters): Promise<PlaybookSummary[]>`
       - `getExistingPlaybooks(districtId: string): Promise<PlaybookSummary[]>`
       - `updatePlaybookSection(playbookId: string, sectionId: string, content: string): Promise<PlaybookSection>`
       - `regenerateSection(playbookId: string, sectionId: string): Promise<{ status: 'generating' }>`
       - `deletePlaybook(playbookId: string): Promise<void>`

    7. **`src/services/index.ts`** — Service registry:
       - Re-export all 6 interface types
       - Re-export all domain types from types/ directory (barrel export)
       - Re-export controlled vocabulary constants

    Use `import type` for type-only imports in interface files. Import from relative paths within services/.

    Method count verification: 3 + 4 + 4 + 6 + 10 + 9 = 36 methods.
  </action>
  <verify>
    - `npx tsc --noEmit` returns exit code 0
    - `ls src/services/interfaces/` shows 6 files
    - `grep "interface IDistrictService" src/services/interfaces/district-service.ts` confirms interface
    - `grep "interface IPlaybookService" src/services/interfaces/playbook-service.ts` confirms interface
    - `grep "IAuthService" src/services/index.ts` confirms re-export
    - Count methods: `grep -c "(" src/services/interfaces/*.ts` should total ~36 method signatures (approximate due to import lines)
  </verify>
  <done>
    All 6 service interfaces defined with 36 methods matching the service contracts. Service registry provides single import point for all types and interfaces. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. All 8 type files exist in src/services/types/
3. All 6 interface files exist in src/services/interfaces/
4. Service registry (src/services/index.ts) re-exports all types and interfaces
5. 36 methods across 6 interfaces match the service contracts document
6. Controlled vocabulary const arrays export correctly
</verification>

<success_criteria>
- All 6 service interfaces (IAuthService, ITenantService, IUserService, IProductService, IDistrictService, IPlaybookService) exist with correct method signatures
- All domain types from service contracts represented as TypeScript interfaces
- Controlled vocabulary types use const arrays with derived types for type safety
- Service registry provides single-file import for all types and interfaces
- TypeScript strict mode compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-shell/01-02-SUMMARY.md`
</output>
