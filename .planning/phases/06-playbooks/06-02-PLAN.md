---
phase: 06-playbooks
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/app/(dashboard)/playbooks/page.tsx
  - src/app/(dashboard)/playbooks/[playbookId]/page.tsx
  - src/components/playbooks/playbook-card.tsx
  - src/components/playbooks/playbook-filters.tsx
  - src/components/playbooks/playbook-section.tsx
  - src/components/playbooks/generation-status.tsx
autonomous: true

must_haves:
  truths:
    - "User can view all playbooks in a list with fit category badges"
    - "User can filter playbooks by fit category (strong/moderate/low)"
    - "User can click a playbook card and see all 6 sections rendered"
    - "User can see generation progress with per-section status indicators"
    - "User can view completed playbook with all sections content"
    - "User can delete a playbook from the list"
  artifacts:
    - path: "src/app/(dashboard)/playbooks/page.tsx"
      provides: "Playbook list page with filtering and cards"
      min_lines: 60
    - path: "src/app/(dashboard)/playbooks/[playbookId]/page.tsx"
      provides: "Playbook detail page with all sections"
      min_lines: 80
    - path: "src/components/playbooks/playbook-card.tsx"
      provides: "Card component for playbook list items"
      min_lines: 30
    - path: "src/components/playbooks/playbook-filters.tsx"
      provides: "Fit category filter controls"
      min_lines: 20
    - path: "src/components/playbooks/playbook-section.tsx"
      provides: "Section renderer for playbook content"
      min_lines: 30
    - path: "src/components/playbooks/generation-status.tsx"
      provides: "Generation progress indicator with per-section status"
      min_lines: 30
  key_links:
    - from: "src/app/(dashboard)/playbooks/page.tsx"
      to: "/api/playbooks"
      via: "fetch in useEffect"
      pattern: "fetch.*api/playbooks"
    - from: "src/app/(dashboard)/playbooks/[playbookId]/page.tsx"
      to: "/api/playbooks/[playbookId]"
      via: "server component direct service call or fetch"
      pattern: "(fetch.*api/playbooks|playbookService\\.getPlaybook)"
    - from: "src/components/playbooks/generation-status.tsx"
      to: "/api/playbooks/[playbookId]/status"
      via: "polling with setInterval"
      pattern: "fetch.*status|setInterval"
---

<objective>
Build the playbook list page and playbook detail/view page, including card components, filter controls, section rendering, and generation progress indicator.

Purpose: Provides the user-facing read experience for playbooks â€” browsing all playbooks with filtering (PLAY-06), viewing completed playbooks with all sections (PLAY-03), viewing generation progress (PLAY-02), and deleting playbooks (PLAY-08).

Output: 2 page files (list + detail) and 4 component files (card, filters, section renderer, generation status).
</objective>

<execution_context>
@/Users/dorenberge/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dorenberge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-playbooks/06-01-SUMMARY.md
@src/services/types/playbook.ts
@src/services/types/common.ts
@src/app/(dashboard)/solutions/page.tsx
@src/app/(dashboard)/solutions/[productId]/page.tsx
@src/components/solutions/product-card.tsx
@src/components/solutions/product-filters.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Playbook list page with filtering and cards</name>
  <files>
    src/app/(dashboard)/playbooks/page.tsx
    src/components/playbooks/playbook-card.tsx
    src/components/playbooks/playbook-filters.tsx
  </files>
  <action>
Replace the stub playbooks/page.tsx with a full client-side ('use client') list page. Follow the pattern from solutions/page.tsx.

**PlaybookFilters component (`src/components/playbooks/playbook-filters.tsx`):**
- Accept props: `{ filters: { fitCategory?: string }, onFiltersChange: (filters) => void }`
- Render 3 filter buttons: All, Strong, Moderate, Low (fit categories)
- Active filter gets primary styling, others get outline/muted styling
- When clicked, update fitCategory filter (or clear when "All" clicked)

**PlaybookCard component (`src/components/playbooks/playbook-card.tsx`):**
- Accept props: `{ playbook: PlaybookSummary, onDelete?: (id: string) => void }`
- Render as a clickable card linking to `/playbooks/{playbookId}`
- Show: districtName (title), productNames as comma-joined subtitle, fitCategory as colored badge (strong=green, moderate=yellow, low=red), generatedAt formatted date
- Show section status indicators: small dots for each section (green=complete, yellow=generating, gray=pending, red=error)
- Delete button (small X icon in top-right) that calls onDelete with confirmation via window.confirm. Stop event propagation on delete click.

**Playbooks list page (`src/app/(dashboard)/playbooks/page.tsx`):**
- 'use client' component
- State: playbooks array, loading, error, fitCategory filter
- Fetch playbooks on mount and when filter changes: `GET /api/playbooks?fitCategory={filter}`
- Page header: "Playbooks" title + subtitle "AI-generated district-specific playbooks for informed outreach."
- PlaybookFilters component below header
- Grid of PlaybookCard components (same grid pattern as solutions: 1 col mobile, 2 md, 3 lg)
- Empty state: "No playbooks yet. Generate your first playbook from a district profile."
- Loading state: "Loading playbooks..."
- Error state: red text
- Delete handler: call `DELETE /api/playbooks/{id}`, on success remove from local state (optimistic pattern from Phase 4)
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit --pretty 2>&1 | head -50`</verify>
  <done>Playbooks list page renders cards with fit category badges. Filter buttons toggle fit category. Delete removes playbook with confirmation. Grid layout matches solutions page pattern.</done>
</task>

<task type="auto">
  <name>Task 2: Playbook detail page with sections and generation status</name>
  <files>
    src/app/(dashboard)/playbooks/[playbookId]/page.tsx
    src/components/playbooks/playbook-section.tsx
    src/components/playbooks/generation-status.tsx
  </files>
  <action>
Replace the stub playbook detail page with a full page showing all sections and generation progress.

**GenerationStatus component (`src/components/playbooks/generation-status.tsx`):**
- 'use client' component
- Accept props: `{ playbookId: string, initialStatus: PlaybookStatusResponse }`
- Polls `GET /api/playbooks/{playbookId}/status` every 2 seconds while overallStatus is 'generating'
- Renders a progress card showing: "Generating playbook..." header, overall status text, list of sections with status indicators (spinner for generating, checkmark for complete, clock for pending, X for error)
- When all sections complete (overallStatus becomes 'complete' or 'partial'), stop polling and call `window.location.reload()` to show full content (simple approach for MVP)
- Use useEffect + setInterval for polling, cleanup on unmount

**PlaybookSection component (`src/components/playbooks/playbook-section.tsx`):**
- Accept props: `{ section: PlaybookSection, playbookId: string }` (read-only rendering for now; editing in Plan 03)
- Render section as a card with: sectionLabel as header, contentSource badge (verbatim/constrained/synthesis/hybrid with different colors), isEdited badge if true
- Content rendered as markdown-like text (split on newlines, render paragraphs). Use `whitespace-pre-wrap` CSS for preserving line breaks.
- If status is 'error': show error message in red with "Failed to generate" label
- If status is 'pending' or 'generating': show skeleton/loading state for that section
- If status is 'complete': show content

**Playbook detail page (`src/app/(dashboard)/playbooks/[playbookId]/page.tsx`):**
- This is a 'use client' component (needs to handle polling and interactivity)
- On mount, fetch playbook detail: `GET /api/playbooks/{playbookId}`. Also fetch status: `GET /api/playbooks/{playbookId}/status`.
- Back navigation link: "Back to Playbooks" with ArrowLeft icon (same pattern as product detail)
- Header section: districtName as title, productNames as badges, fitCategory badge (colored), generatedAt date
- Fit rationale: Show fitAssessment.fitRationale in an info card below header
- If overallStatus is 'generating': show GenerationStatus component with polling
- If overallStatus is 'complete' or 'partial': render all sections using PlaybookSection components in a single-column stack with spacing
- Section order: key_themes, product_fit, objections, stakeholders, district_data, fit_assessment
- Delete button in header (same pattern as admin actions)
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit --pretty 2>&1 | head -50`</verify>
  <done>Playbook detail page shows all 6 sections rendered with content. Generation status polls and shows per-section progress. Back navigation to playbook list. Fit assessment displayed prominently.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. Playbooks list page fetches and renders playbook cards
3. Fit category filter buttons toggle filter and re-fetch
4. Playbook detail page shows all 6 sections with content
5. Generation status component polls for progress during generation
6. Delete works from both list page and detail page
</verification>

<success_criteria>
- Playbook list page shows cards with district names, product names, fit badges, and section status dots
- Filter by fit category works (All/Strong/Moderate/Low)
- Playbook detail page renders all 6 sections with proper formatting
- Generation progress shows per-section status indicators
- Delete removes playbook with optimistic UI update
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/06-playbooks/06-02-SUMMARY.md`
</output>
